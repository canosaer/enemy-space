class Game{constructor(){this.referenceDeck=new Deck,this.gameDeck=new Deck,this.player=new Player,this.missileDialog=document.querySelector(".missile-dialog"),this.missileNumbers=document.querySelectorAll(".missile-dialog__number-button"),this.missileTypes=document.querySelectorAll(".missile-dialog__missile-type"),this.lightMissileIndex=0,this.heavyMissileIndex=0,this.turnActions=[],this.setupListeners(),new MessageHandler,this.setupShip(),this.setupOpponent(),this.setupCrew()}setupListeners(){document.querySelector(".game-display__title").addEventListener("click",this.returnToTitle),document.querySelector(".game-display__subtitle").addEventListener("click",this.returnToTitle),document.addEventListener("removeCrewListeners",this.toggleCrewListeners),document.addEventListener("advancePhase",this.advancePhase),document.addEventListener("togglePlayerComponents",this.togglePlayerComponentListeners),this.missileNumbers.forEach((e=>{e.addEventListener("click",this.queueMissiles)})),this.missileTypes.forEach((e=>{e.addEventListener("click",this.selectMissileType)}))}returnToTitle(){localStorage.setItem("dm21GameState","paused"),document.querySelector(".title-screen").classList.remove("hidden"),document.querySelector(".game-display").classList.add("hidden")}setupShip=()=>{this.level=1,this.player.components.installed=[this.referenceDeck.cards[5],this.referenceDeck.cards[6],this.referenceDeck.cards[9],this.referenceDeck.cards[1]];let e=new CustomEvent("renderInstalledComponents");document.dispatchEvent(e)};setupOpponent=()=>{this.opponent=new Opponent;let e=new CustomEvent("setupOpponent",{detail:{level:this.level,referenceDeck:this.referenceDeck}});document.dispatchEvent(e)};setupCrew=()=>{this.logMessage('Select Crew: Under "Crew," click on your Pilot, Gunner, or Engineer to add a +2 bonus to that crew member.'),sessionStorage.setItem("dm21IncreaseLevel","2"),sessionStorage.setItem("dm21GamePhase","crewSetup"),this.toggleCrewListeners()};advancePhase=e=>{"crewSetup"===sessionStorage.getItem("dm21GamePhase")&&(sessionStorage.setItem("dm21GamePhase","combat"),this.startLevel())};toggleCrewListeners=()=>{crewElements.forEach((e=>{e.classList.toggle("clickable")})),crewElements[0].classList.contains("clickable")?(crewContainer.querySelector(".crew__pilot").addEventListener("click",this.increasePilot),crewContainer.querySelector(".crew__gunner").addEventListener("click",this.increaseGunner),crewContainer.querySelector(".crew__engineer").addEventListener("click",this.increaseEngineer)):(crewContainer.querySelector(".crew__pilot").removeEventListener("click",this.increasePilot),crewContainer.querySelector(".crew__gunner").removeEventListener("click",this.increaseGunner),crewContainer.querySelector(".crew__engineer").removeEventListener("click",this.increaseEngineer))};increasePilot=()=>{let e=new CustomEvent("increaseCrew",{detail:{crew:"pilot"}});document.dispatchEvent(e)};increaseGunner=()=>{let e=new CustomEvent("increaseCrew",{detail:{crew:"gunner"}});document.dispatchEvent(e)};increaseEngineer=()=>{let e=new CustomEvent("increaseCrew",{detail:{crew:"engineer"}});document.dispatchEvent(e)};logMessage(e){let t=new CustomEvent("message",{detail:{message:e}});document.dispatchEvent(t)}startLevel=()=>{document.querySelector(".player-mat_opponent").classList.toggle("hidden"),this.logMessage("Combat begins!"),this.togglePlayerComponentListeners(),this.toggleSpecialActionListeners()};togglePlayerComponentListeners=()=>{this.componentDisplay=document.querySelector(".components_human"),this.components=this.componentDisplay.querySelectorAll(".components__item"),this.components.forEach((e=>{e.classList.toggle("clickable"),e.classList.contains("clickable")?e.addEventListener("click",this.handlePlayerComponentClick):e.removeEventListener("click",this.handlePlayerComponentClick)}))};toggleSpecialActionListeners=()=>{this.specialActions=document.querySelectorAll(".special-actions__button"),this.specialActions.forEach((e=>{e.classList.toggle("clickable"),e.classList.contains("clickable")?e.addEventListener("click",this.handleSpecialActionClick):e.removeEventListener("click",this.handleSpecialActionClick)}))};findComponentIndex=e=>{for(let t=0;t<this.player.components.installed.length;t++)if(this.player.components.installed[t].title===e)return t;return-1};handleSpecialActionClick=e=>{e.target.classList.contains("special-actions__button_attack-run")&&this.logMessage("Select Weapon")};handlePlayerComponentClick=e=>{e.target.classList.toggle("focus");let t=e.target.style.background.toString();if(e.target.classList.contains("focus")){for(let e=0;e<this.player.components.installed.length;e++)-1!=t.indexOf(this.player.components.installed[e].image)&&(this.selectedComponent=this.player.components.installed[e]);"Missile Launcher"===this.selectedComponent.title&&(-1!=this.findComponentIndex("Light Missiles")?this.lightMissileIndex=this.findComponentIndex("Light Missiles"):-1!=this.findComponentIndex("Heavy Missiles")&&(this.lightMissileIndex=this.findComponentIndex("Heavy Missiles")),this.missileDialog.classList.toggle("hidden"),this.heavyMissileIndex&&this.lightMissileIndex?this.missileDialog.querySelector(".missile-dialog__type").classList.toggle("hidden"):(this.lightMissileIndex?this.activeMissileIndex=this.lightMissileIndex:this.activeMissileIndex=this.heavyMissileIndex,this.selectMissileNumber()))}};selectMissileType=e=>{console.log(e.target)};selectMissileNumber=()=>{this.missileDialog.querySelector(".missile-dialog__number").classList.toggle("hidden");let e=this.player.components.installed[this.activeMissileIndex].counter;this.activeMissileIndex===this.lightMissileIndex?this.maxMissiles=e>4?4:e:activeMissileQUantity>2?this.maxMissiles=2:this.maxMissiles=e;for(let e=0;e<this.maxMissiles;e++)this.missileNumbers[e].classList.toggle("hidden")};queueMissiles=e=>{this.missileDialog.querySelector(".missile-dialog__number").classList.toggle("hidden"),this.missileDialog.classList.toggle("hidden");let t={log:`Fire ${e.target.textContent} ${this.player.components.installed[this.activeMissileIndex].title}`,type:"attack",missiles:e.target.textContent,value:this.player.components.installed[this.activeMissileIndex].attack};this.turnActions.push(t),this.player.components.installed[this.activeMissileIndex].counter=this.player.components.installed[this.activeMissileIndex].counter-e.target.textContent,0===this.player.components.installed[this.activeMissileIndex].counter&&(this.player.components.installed.splice(this.activeMissileIndex),this.player.components.installed.splice(this.findComponentIndex("Missile Launcher"))),this.completeAction()};completeAction=()=>{let e="";for(let t=0;t<this.turnActions.length;t++)e+=this.turnActions[t].log,this.turnActions.length>1&&t!=this.turnActions.length&&(e+=", ");this.logMessage(e),this.player.renderInstalledComponents()};saveGame(){localStorage.setItem("dm21Save",JSON.stringify({player:this.player,gameDeck:this.gameDeck}))}loadGame(){try{const e=JSON.parse(localStorage.getItem("dm21Save"));if(e&&e.gameDeck)return this.gameDeck=Deck().restore(e.gameDeck.cards),this.player=Player().restore(e.player.bonus,e.player.crewElements,e.player.components,e.player.repeat),!0}catch(e){console.error("no game state")}return!1}}
//# sourceMappingURL=game.js.map